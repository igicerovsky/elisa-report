import fitdata
import pytest
import numpy as np


def test_func():
    assert fitdata.func(1.0e9, 0.01, 0.9, 500_000_000.0, 1.0) == pytest.approx(0.6545787829565919)


def test_inv_func():
    assert fitdata.inv_func(0.6, 0.01, 0.9, 500_000_000.0, 1.0 ) == pytest.approx(770046043.1062976)


def test_fit_reference():
    x = np.array([17954000000.0, 8977000000.0, 4488500000.0, 2244250000.0, 1122125000.0, 561062500.0, 280531250.0])
    y = np.array([1.4609, 0.7627, 0.45620000000000005, 0.29560000000000003, 0.15300000000000002, 0.0824, 0.0465])
    r = fitdata.fit_reference(fitdata.func, x, y)

    e0 = np.array([0.024639739977099576, 0.8758817990197846, 123757366016010.23, 3278.555705605853])
    e1 = np.array([ [0.001362946571509995, 0.004811422054020865, -1397312652675520.8, -32271.26458007298],
                    [0.004811422054020865, 0.03321247562158081, -1.3469057646421174e+16, -311435.8011114633],
                    [-1397312652675520.8, -1.3469057646421174e+16, 6.376419686260148e+33, 1.4750194830685844e+23],
                    [-32271.26458007298, -311435.8011114633, 1.4750194830685844e+23, 3412079290688.4424]])
    
    np.testing.assert_array_almost_equal(e0, r[0])
    np.testing.assert_array_almost_equal(e1, r[1])
